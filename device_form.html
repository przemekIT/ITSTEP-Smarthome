{% load static %}
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>{{ title|default:"Urządzenie" }} - SmartKey</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">SmartKey</a>
        <div class="d-flex">
            <a class="btn btn-outline-light me-2" href="/">Dashboard</a>
            <a class="btn btn-light me-2" href="/devices/">Urządzenia</a>
            <a class="btn btn-outline-light me-2" href="/rules/">Reguły</a>
            <a class="btn btn-outline-light me-2" href="/devices/logs/">Logi</a>
            <a class="btn btn-outline-light" href="/settings/">Ustawienia</a>
        </div>
    </div>
</nav>

<div class="container">
    <h3 class="mb-4">{{ title }}</h3>

    <div class="card shadow-sm">
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                {{ form.as_p }}
                <button type="submit" class="btn btn-primary">Zapisz</button>
                <a href="{% url 'device_list' %}" class="btn btn-secondary ms-2">Anuluj</a>
            </form>
        </div>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function () {
    // Pola wygenerowane przez Django: ich ID to zazwyczaj 'id_nazwaPola'
    const typeSelect   = document.getElementById('id_type');
    const statusField  = document.getElementById('id_status');
    const valueField   = document.getElementById('id_value');

    function updateFields() {
        if (!typeSelect) return;
        const typ = typeSelect.value;

        if (typ === 'sensor') {
            // CZUJNIK:
            // - ma wartosc liczbowa
            // - nie ma stanu ON/OFF
            if (statusField) {
                statusField.checked = false;   // upewniamy sie, ze jest odznaczone
                statusField.disabled = true;   // nie pozwalamy zaznaczyc
            }
            if (valueField) {
                valueField.disabled = false;   // wartosc czujnika aktywna
            }

        } else if (typ === 'light' || typ === 'plug') {
            // LAMPA / GNIAZDKO:
            // - maja stan ON/OFF
            // - nie maja wartosci liczbowej
            if (statusField) {
                statusField.disabled = false;  // pozwalamy wlaczac / wylaczac
            }
            if (valueField) {
                valueField.value = '';         // czyscimy
                valueField.disabled = true;    // wylaczamy pole value
            }

        } else {
            // Dla innych typow (na przyszlosc) – wszystko dostepne
            if (statusField) statusField.disabled = false;
            if (valueField)  valueField.disabled  = false;
        }
    }

    if (typeSelect) {
        // Uruchamiamy logike przy starcie (np. przy edycji istniejacego urzadzenia)
        updateFields();
        // Oraz za kazdym razem gdy uzytkownik zmienia typ
        typeSelect.addEventListener('change', updateFields);
    }
});
</script>

</body>
</html>
